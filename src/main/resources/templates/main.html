<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë‹¥í„°ì§€ì˜¤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
    .link-hover:hover {
      text-decoration: underline;
      font-weight: bold;
      opacity: 0.85;    
    }
    
    .clicked-item {
    background-color: #e0f7fa;
    font-weight: bold;
    border-left: 5px solid #00bcd4;
    }
    </style>
    
</head>
<body>

<div class="d-flex justify-content-end align-items-center pe-4 pt-2" style="background-color: white; gap: 0.5rem;">
    <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ -->

    <div sec:authorize="isAnonymous()">
        <a th:href="@{/member/login}" class="btn btn-sm btn-outline-primary me-2">ë¡œê·¸ì¸</a>
        <a th:href="@{/member/signup}" class="btn btn-sm btn-outline-success">íšŒì›ê°€ì…</a>
    </div>

    <!-- ë¡œê·¸ì¸ ìƒíƒœ -->
    <div sec:authorize="isAuthenticated()">
        <a th:href="@{/member/mypage}" class="btn btn-sm btn-outline-secondary me-2">ë‚´ì •ë³´</a>
        <a th:href="@{/member/logout}" class="btn btn-sm btn-outline-danger">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</div>

<!-- ë¡œê³  (ì™¼ìª½ ì •ë ¬, nav ìœ„ì— ìœ„ì¹˜) -->
<div class="py-4" style="padding-left: 120px; background-color: white; border-bottom: 1px solid #ddd;">
    <a th:href="@{/}" class="d-inline-flex align-items-center gap-4">
        <img src="/images/ë‹¥í„°ì§€ì˜¤1.jpg" alt="ë‹¥í„°ì§€ì˜¤ ë¡œê³ " style="height: 130px;">
        <img src="/images/ë‹¥í„°ì§€ì˜¤2.jpg" alt="ë‹¥í„°ì§€ì˜¤ ë¡œê³ " style="height: 130px;">
    </a>
</div>

<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary px-5">
  <div class="container-fluid d-flex justify-content-center">
    <div class="d-flex align-items-center" style="gap: 18rem;">

      <!-- ë©”ì¸ ë“œë¡­ë‹¤ìš´ -->
      <div class="dropdown">
        <a class="nav-link dropdown-toggle fw-bold text-white fs-4" href="#" role="button" data-bs-toggle="dropdown">
          Main
        </a>
        <ul class="dropdown-menu p-3" style="width: 800px;">
        <div class="d-flex flex-row gap-4">
           <li class="dropdown-item">
	           <strong>ì»¤ë®¤ë‹ˆí‹°</strong>
	           <ul class="list-unstyled ps-3">
	               <li><a href="/question/list" class="nav-link px-0 fw-semibold link-hover text-dark">ë¬¸ì˜</a></li>
	               <li><a href="/post/notice" class="nav-link px-0 fw-semibold link-hover text-dark">ê³µì§€ì‚¬í•­</a></li>
	               <li><a href="/post/list" class="nav-link px-0 fw-semibold link-hover text-dark">ììœ ê²Œì‹œíŒ</a></li>
	           </ul>
          </li>
           <li class="dropdown-item">
	           <strong>ì•½í’ˆ</strong>
	           <ul class="list-unstyled ps-3">
	               <li><a href="/supplement/all" class="nav-link px-0 fw-semibold link-hover text-dark">ì˜ì–‘ì œì •ë³´</a></li>
	               <li><a href="/otc/list" class="nav-link px-0 fw-semibold link-hover text-dark">í¸ì˜ì ìƒë¹„ì•½</a></li>
	               <li><a href="/category/all" class="nav-link px-0 fw-semibold link-hover text-dark">ì¼ë°˜ì˜ì•½í’ˆ</a></li>
	           </ul>
          </li>
          <li class="dropdown-item">
            <strong>ì§ˆë³‘ì •ë³´</strong>
            <ul class="list-unstyled ps-3">
              <li><a href="/disease/self_diagnosis" class="nav-link px-0 fw-semibold link-hover text-dark">ìê°€ì§„ë‹¨</a></li>
              <li><a href="/disease/list" class="nav-link px-0 fw-semibold link-hover text-dark">ì§ˆë³‘ê²€ìƒ‰</a></li>
            </ul>
          </li>
          <li class="dropdown-item">
            <strong>íšŒì›</strong>
            <ul class="list-unstyled ps-3">
              <li>ê°œì¸ì •ë³´</li>
            </ul>
          </li>
          </div>
        </ul>
      </div>

      <!-- ì¤‘ê°„ ë©”ë‰´ -->
      <ul class="navbar-nav d-flex flex-row align-items-center" style="gap: 1.5rem;">
        <li class="nav-item" sec:authorize="hasRole('ROLE_ADMIN')">
          <a class="nav-link text-warning fw-bold" th:href="@{/member/admin}">ê´€ë¦¬ìí˜ì´ì§€</a>
        </li>
      </ul>

      <div class="dropdown">
        <a id="mapDropdown"
            class="nav-link fw-bold text-white fs-4"
            href="#"
            role="button"
            data-bs-toggle="dropdown">
         ì§€ë„
       </a>
      </div>
      
        <ul class="dropdown-menu p-3" style="width: 800px;">
        <div class="d-flex flex-row gap-4">
          <li class="dropdown-item">
            <strong>ì¼ë°˜ë³‘ì›</strong>
            <ul class="list-unstyled ps-3">
              <li>ìœ„ì¹˜</li>
              <li>ì§„ë£Œê³¼</li>
              <li>ê°€ê¹Œìš´ ë³‘ì›</li>
              <li>ì˜ë£Œì§„ í”„ë¡œí•„</li>
              <li>ì˜ë£Œ ì·¨ì•½ì§€ì—­</li>
              <li>ì˜ˆë°©ì ‘ì¢…</li>
              <li>ê±´ê°•ê²€ì§„</li>
              <li>ì…ì›ì‹¤</li>
              <li>ì¸ê¸°ë³‘ì›</li>
            </ul>
          </li>
          <li class="dropdown-item">
            <strong>í•œì˜ì›</strong>
            <ul class="list-unstyled ps-3">
              <li>ìœ„ì¹˜</li>
              <li>ì§„ë£Œê³¼</li>
              <li>ê°€ê¹Œìš´ í•œì˜ì›</li>
              <li>365 í•œì˜ì›</li>
            </ul>
          </li>
          <li class="dropdown-item">
            <strong>ë³´ê±´ì†Œ</strong>
            <ul class="list-unstyled ps-3">
              <li>ìœ„ì¹˜</li>
              <li>ì˜ˆë°©ì ‘ì¢…</li>
              <li>ê°€ëŠ¥í•œ ê²€ì‚¬</li>
              <li>ë³´ê±´ì†Œ ì‚¬ì—…</li>
            </ul>
          </li>
          <li class="dropdown-item">
            <strong>ì‘ê¸‰</strong>
            <ul class="list-unstyled ps-3">
              <li>ìœ„ì¹˜</li>
            </ul>
          </li>
          <li class="dropdown-item">
            <strong>ì•½êµ­</strong>
            <ul class="list-unstyled ps-3">
              <li>ìœ„ì¹˜</li>
            </ul>
           </li>
          </div>
        </ul>
      </div>

    </div>
  </div>
</nav>

<!-- ë©”ì¸ ì½˜í…ì¸  -->
<div class="container mt-5">
    <!-- ê²€ìƒ‰ì°½ -->
    <div class="row justify-content-center mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <input type="text" id="mainSearchInput" class="form-control form-control-lg" 
                       placeholder="ì§€ì—­ì´ë‚˜ ë³‘ì›ëª…ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”">
                <button class="btn btn-primary btn-lg" type="button" onclick="searchHospital()">
                    <i class="bi bi-search"></i> ê²€ìƒ‰
                </button>
            </div>
        </div>
    </div>
    
    <!-- ìš°ë¦¬ë™ë„¤ ë³‘ì› ê²€ìƒ‰ ë²„íŠ¼ (ë¡œê·¸ì¸ ì‹œì—ë§Œ í‘œì‹œ) -->
	<div class="row justify-content-center mb-5" sec:authorize="isAuthenticated()">
	    <div class="col-md-8">
	        <div class="d-flex gap-3">
	            <select id="neighborCategory" class="form-select">
	                <option value="">ë³‘ì› êµ¬ë¶„</option>
	                <option value="ìƒê¸‰ì¢…í•©">ìƒê¸‰ì¢…í•©</option>
	                <option value="ì¢…í•©ë³‘ì›">ì¢…í•©ë³‘ì›</option>
	                <option value="ë³‘ì›">ë³‘ì›</option>
	                <option value="ì •ì‹ ë³‘ì›">ì •ì‹ ë³‘ì›</option>
	                <option value="ì˜ì›">ì˜ì›</option>
	                <option value="ì¹˜ê³¼ë³‘ì›">ì¹˜ê³¼ë³‘ì›</option>
	                <option value="ì¹˜ê³¼ì˜ì›">ì¹˜ê³¼ì˜ì›</option>
	                <option value="í•œë°©ë³‘ì›">í•œë°©ë³‘ì›</option>
	                <option value="í•œì˜ì›">í•œì˜ì›</option>
	                <option value="ìš”ì–‘ë³‘ì›">ìš”ì–‘ë³‘ì›</option>
	            </select>
	            <select id="neighborDept" class="form-select">
	                <option value="">ì§„ë£Œê³¼ ì„ íƒ</option>
	            </select>
	            <button class="btn btn-success px-4 fw-semibold" style="width: 300px;" onclick="searchNeighborhood()">
	                <i class="bi bi-geo-alt"></i> ìš°ë¦¬ë™ë„¤ ë³‘ì›ì°¾ê¸°
	            </button>
	        </div>
	    </div>
	</div>
   
<div class="container my-5 position-relative">
    <!-- ë‰´ìŠ¤ ì„¹ì…˜ -->
    <div class="row">
        <div class="col-md-9">
            <div class="card">
                <div class="card-header bg-info text-white fw-bold">
                    ğŸ“° ë³´ê±´ë³µì§€ë¶€ ìµœì‹  ë‰´ìŠ¤
                </div>
                <ul id="newsList" class="list-group list-group-flush"></ul>
            </div>
        </div>
        
        <!-- ì¸ê¸°ë³‘ì› ìˆœìœ„ -->
        <div class="col-md-3">
            <div class="card shadow-sm sticky-top" style="top: 20px;">
                <div class="card-header bg-primary text-white fw-bold">
                    ğŸ”¥ ì¸ê¸° ë³‘ì› ìˆœìœ„
                </div>
                <ul id="popularList" class="list-group list-group-flush"></ul>
            </div>
        </div>
    </div>
</div>

<!-- í•˜ë‹¨ í‘¸í„° -->
<footer class="bg-light text-center py-4 mt-5 border-top">
    <div class="container">
        <p class="mb-0">Â© 2025 ì˜ë£Œì •ë³´ í”Œë«í¼. All Rights Reserved.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
window.onload = function() {     
    //ì£¼ì†Œ ì—†ì„ì‹œ ìë™ìœ¼ë¡œ ìˆ˜ì •í¼ìœ¼ë¡œ ì´ë™ + alert
    if("[[${dto}]]" !== "null" || "[[${dto}]]" !== "") {
	    if ("[[${dto.address}]]" === "null" || "[[${dto.address}]]" === "") { 
	        console.log("ì£¼ì†Œ ê°’ì´ nullì„. alertë¥¼ ë„ìš°ê³  í˜ì´ì§€ë¥¼ ì´ë™í•©ë‹ˆë‹¤.");
	        
	        // alert ë„ìš°ê¸°
	        alert("ì£¼ì†Œ ë° ê°œì¸ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤. í•´ë‹¹ í˜ì´ì§€ì—ì„œ ìˆ˜ì •í•´ì£¼ì„¸ìš”.");
	
	        // ê°•ì œë¡œ /member/modify í˜ì´ì§€ë¡œ ì´ë™
	        window.location.href = "/member/modify";
	    } else {
	        console.log("ì£¼ì†Œ ê°’ì´ nullì´ ì•„ë‹˜. í˜ì´ì§€ ì´ë™í•˜ì§€ ì•ŠìŒ.");
	    }
    }
};

//âœ… ë‰´ìŠ¤ JSON ê°€ì ¸ì˜¤ê¸° ì¶”ê°€
fetch("/api/news")
  .then(res => res.json())
  .then(data => {
    const list = document.getElementById("newsList");
    for (let i = 0; i < data.title.length; i++) {
      const li = document.createElement("li");
      li.className = "list-group-item";
      li.innerHTML = `<a href="${data.link[i]}" target="_blank" class="text-decoration-none text-dark">
        ${data.title[i]} <small class="text-muted">(${data.date[i]})</small>
      </a>`;
      list.appendChild(li);
    }
  })
  .catch(err => {
    console.error("âŒ ë‰´ìŠ¤ ë¡œë”© ì‹¤íŒ¨:", err);
    document.getElementById("newsList").innerHTML =
      "<li class='list-group-item'>ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>";
  });

    document.getElementById('mapDropdown').addEventListener('click', function () {
	  location.href = '/map/main';
	});

    fetch("/map/popular")
      .then(res => res.json())
      .then(data => {
                     const list = document.getElementById("popularList");
                     list.innerHTML = "";

      if (data.length === 0) {
                     const li = document.createElement("li");
                     li.className = "list-group-item";
                     li.innerText = "ğŸ“­ ì¸ê¸° ë³‘ì›ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.";
                     list.appendChild(li);
      }
      data.forEach((h, i) => {
                     const li = document.createElement("li");
                     li.className = "list-group-item";
                     li.innerHTML = `<a href="/map/hospitaldetail?name=${encodeURIComponent(h.hospitalName)}&address=${encodeURIComponent(h.address)}&phone=${encodeURIComponent(h.phoneNumber)}&category=${encodeURIComponent(h.category)}&lat=${h.latitude}&lng=${h.longitude}" class="text-decoration-none text-dark">
                    	  ${i + 1}ìœ„ ğŸ¥ ${h.hospitalName} (${h.address})
                    	</a>`;
                    	li.addEventListener('click', () => {
                        document.querySelectorAll('#popularList .list-group-item')
                          .forEach(item => item.classList.remove('clicked-item'));
                        li.classList.add('clicked-item');
                        
                        window.open(url, "_blank");
                      });
                    	
                     list.appendChild(li);
                         });
      });
    function searchHospital() {
        const keyword = document.getElementById('mainSearchInput').value.trim();
        if (keyword) {
            location.href = `/map/main?keyword=${encodeURIComponent(keyword)}`;
        } else {
            alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }
    }

    // ì—”í„°í‚¤ë¡œë„ ê²€ìƒ‰ë˜ë„ë¡ ì„¤ì •
    document.getElementById('mainSearchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchHospital();
        }
    });
    const deptList = {
    	    "A": ["ë‚´ê³¼", "ì‹ ê²½ê³¼", "ì •ì‹ ê±´ê°•ì˜í•™ê³¼", "ì™¸ê³¼", "ì •í˜•ì™¸ê³¼", "ì‹ ê²½ì™¸ê³¼", "ì‹¬ì¥í˜ˆê´€í‰ë¶€ì™¸ê³¼", "ì„±í˜•ì™¸ê³¼", "ë§ˆì·¨í†µì¦ì˜í•™ê³¼", "ì‚°ë¶€ì¸ê³¼", "ì†Œì•„ì²­ì†Œë…„ê³¼", "ì•ˆê³¼", "ì´ë¹„ì¸í›„ê³¼", "í”¼ë¶€ê³¼", "ë¹„ë‡¨ì˜í•™ê³¼", "ì˜ìƒì˜í•™ê³¼", "ë°©ì‚¬ì„ ì¢…ì–‘í•™ê³¼", "ë³‘ë¦¬ê³¼", "ì§„ë‹¨ê²€ì‚¬ì˜í•™ê³¼", "ê²°í•µê³¼", "ì¬í™œì˜í•™ê³¼", "í•µì˜í•™ê³¼", "ê°€ì •ì˜í•™ê³¼", "ì‘ê¸‰ì˜í•™ê³¼", "ì§ì—…í™˜ê²½ì˜í•™ê³¼", "ì˜ˆë°©ì˜í•™ê³¼"],
    	    "B": ["ì¹˜ê³¼", "êµ¬ê°•ì•…ì•ˆë©´ì™¸ê³¼", "ì¹˜ê³¼ë³´ì² ê³¼", "ì¹˜ê³¼êµì •ê³¼", "ì†Œì•„ì¹˜ê³¼", "ì¹˜ì£¼ê³¼", "ì¹˜ê³¼ë³´ì¡´ê³¼", "êµ¬ê°•ë‚´ê³¼", "ì˜ìƒì¹˜ì˜í•™ê³¼", "êµ¬ê°•ë³‘ë¦¬ê³¼", "ì˜ˆë°©ì¹˜ê³¼", "í†µí•©ì¹˜ì˜í•™ê³¼"],
    	    "C": ["í•œë°©ë‚´ê³¼", "í•œë°©ë¶€ì¸ê³¼", "í•œë°©ì†Œì•„ê³¼", "í•œë°©ì•ˆÂ·ì´ë¹„ì¸í›„Â·í”¼ë¶€ê³¼", "í•œë°©ì‹ ê²½ì •ì‹ ê³¼", "ì¹¨êµ¬ê³¼", "í•œë°©ì¬í™œì˜í•™ê³¼", "ì‚¬ìƒì²´ì§ˆê³¼", "í•œë°©ì‘ê¸‰"],
    	    "D": ["ë‚´ê³¼", "ì‹ ê²½ê³¼", "ì •ì‹ ê±´ê°•ì˜í•™ê³¼", "ì™¸ê³¼", "ì •í˜•ì™¸ê³¼", "ì‹ ê²½ì™¸ê³¼", "ì‹¬ì¥í˜ˆê´€í‰ë¶€ì™¸ê³¼", "ì„±í˜•ì™¸ê³¼", "ë§ˆì·¨í†µì¦ì˜í•™ê³¼", "ì‚°ë¶€ì¸ê³¼", "ì†Œì•„ì²­ì†Œë…„ê³¼", "ì•ˆê³¼", "ì´ë¹„ì¸í›„ê³¼", "í”¼ë¶€ê³¼", "ë¹„ë‡¨ì˜í•™ê³¼", "ì˜ìƒì˜í•™ê³¼", "ë°©ì‚¬ì„ ì¢…ì–‘í•™ê³¼", "ë³‘ë¦¬ê³¼", "ì§„ë‹¨ê²€ì‚¬ì˜í•™ê³¼", "ê²°í•µê³¼", "ì¬í™œì˜í•™ê³¼", "í•µì˜í•™ê³¼", "ê°€ì •ì˜í•™ê³¼", "ì‘ê¸‰ì˜í•™ê³¼", "ì§ì—…í™˜ê²½ì˜í•™ê³¼", "ì˜ˆë°©ì˜í•™ê³¼", "í•œë°©ë‚´ê³¼", "í•œë°©ë¶€ì¸ê³¼", "í•œë°©ì†Œì•„ê³¼", "í•œë°©ì•ˆÂ·ì´ë¹„ì¸í›„Â·í”¼ë¶€ê³¼", "í•œë°©ì‹ ê²½ì •ì‹ ê³¼", "ì¹¨êµ¬ê³¼", "í•œë°©ì¬í™œì˜í•™ê³¼", "ì‚¬ìƒì²´ì§ˆê³¼", "í•œë°©ì‘ê¸‰"],
    	    "E": []
    	};

    	function getGroupByCategory(category) { 
    	    if (["ìƒê¸‰ì¢…í•©", "ì¢…í•©ë³‘ì›", "ë³‘ì›", "ì •ì‹ ë³‘ì›", "ì˜ì›"].includes(category)) return "A";
    	    if (["ì¹˜ê³¼ë³‘ì›", "ì¹˜ê³¼ì˜ì›"].includes(category)) return "B";
    	    if (["í•œë°©ë³‘ì›", "í•œì˜ì›"].includes(category)) return "C";
    	    if (["ìš”ì–‘ë³‘ì›"].includes(category)) return "D";
    	    return "E";
    	}

    	// ì§„ë£Œ ìœ í˜• ë³€ê²½ ì‹œ, ì§„ë£Œê³¼ select ë™ì  ë³€ê²½
    	document.getElementById('neighborCategory').addEventListener('change', function() {
    	    const category = this.value;
    	    const deptSelect = document.getElementById('neighborDept');
    	    deptSelect.innerHTML = '<option value="">ì§„ë£Œê³¼ ì„ íƒ</option>';  // ì´ˆê¸°í™”

    	    if (!category) return;

    	    const group = getGroupByCategory(category);
    	    const depts = deptList[group];

    	    if (!depts || depts.length === 0) return;

    	    depts.forEach(dept => {
    	        const opt = document.createElement("option");
    	        opt.value = dept;
    	        opt.textContent = dept;
    	        deptSelect.appendChild(opt);
    	    });
    	});

    	function searchNeighborhood() {
    	    const category = document.getElementById('neighborCategory').value;
    	    const dept = document.getElementById('neighborDept').value;

    	    if (!category) {
    	        alert('ì§„ë£Œ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
    	        return;
    	    }

    	    location.href = `/map/main?category1=${encodeURIComponent(category)}&dept1=${encodeURIComponent(dept)}&nearby=true`;
    	}
    	
    	
    </script>
   
</body>
</html>
