<!DOCTYPE html>
<html>
<head>
    <title>ì£¼ë³€ ë³‘ì› ì°¾ê¸°</title>
    <style>
        #map { width: 75%; height: 800px; float: right; }
        #hospitalList { 
            width: 25%; 
            height: 750px;  /* ë²„íŠ¼ ê³µê°„ í™•ë³´ */
            overflow-y: scroll; 
            float: left; 
            background: #f8f9fa; 
            padding: 10px; 
            box-sizing: border-box; 
        }
        .hospital-item { 
            cursor: pointer; 
            padding: 12px; 
            border-bottom: 1px solid #ddd; 
            font-size: 14px;
        }
        .hospital-item:hover { background-color: #e9ecef; }
        
        /* ê°•ì¡° í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .highlight {
            background-color: #ffeb3b; /* ë…¸ë€ìƒ‰ */
            font-weight: bold;
        }

        /* ê¸¸ì°¾ê¸° ë²„íŠ¼ (í•˜ë‹¨ ê³ ì •) */
        .directions-container {
            width: 25%;
            height: 50px;
            background: #e0e0e0; /* íŠ€ì§€ ì•ŠëŠ” ì—°í•œ íšŒìƒ‰ */
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            bottom: 0;
            left: 0;
        }
        .directions-btn {
            background: #d6d6d6; /* ì—°í•œ íšŒìƒ‰ ë²„íŠ¼ */
            color: black;
            border: none;
            border-radius: 5px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .directions-btn:hover {
            background: #bfbfbf; /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì‚´ì§ ì–´ë‘ìš´ íšŒìƒ‰ */
        }
    </style>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1590e9c87b932ff3afa865646fc52061&libraries=services"></script>
</head>
<body>
    <div id="categoryContainer">
        <button class="category-btn" onclick="filterCategory('ìƒê¸‰ì¢…í•©ë³‘ì›')">ğŸ¥ ìƒê¸‰ì¢…í•©ë³‘ì›</button>
        <button class="category-btn" onclick="filterCategory('ì¢…í•©ë³‘ì›')">ğŸ¥ ì¢…í•©ë³‘ì›</button>
        <button class="category-btn" onclick="filterCategory('ë³‘ì›')">ğŸ¥ ë³‘ì›</button>
        <button class="category-btn" onclick="filterCategory('ìš”ì–‘ë³‘ì›')">ğŸ¥ ìš”ì–‘ë³‘ì›</button>
        <button class="category-btn" onclick="filterCategory('ì •ì‹ ë³‘ì›')">ğŸ¥ ì •ì‹ ë³‘ì›</button>
        <button class="category-btn" onclick="filterCategory('ì˜ì›')">ğŸ¥ ì˜ì›</button>
        <button class="category-btn" onclick="filterCategory('ì¹˜ê³¼ë³‘ì›')">ğŸ¦· ì¹˜ê³¼ë³‘ì›</button>
        <button class="category-btn" onclick="filterCategory('ì¹˜ê³¼ì˜ì›')">ğŸ¦· ì¹˜ê³¼ì˜ì›</button>
        <button class="category-btn" onclick="filterCategory('í•œë°©ë³‘ì›')">ğŸŒ¿ í•œë°©ë³‘ì›</button>
        <button class="category-btn" onclick="filterCategory('í•œì˜ì›')">ğŸŒ¿ í•œì˜ì›</button>
        <button class="category-btn" onclick="filterCategory('ë³´ê±´ì†Œ')">ğŸ¥ ë³´ê±´ì†Œ</button>
        <button class="category-btn" onclick="filterCategory('ë³´ê±´ì§„ë£Œì†Œ')">ğŸ¥ ë³´ê±´ì§„ë£Œì†Œ</button>
        <button class="category-btn" onclick="filterCategory('ë³´ê±´ì§€ì†Œ')">ğŸ¥ ë³´ê±´ì§€ì†Œ</button>
        <button class="category-btn" onclick="filterCategory('ì¡°ì‚°ì›')">ğŸ¼ ì¡°ì‚°ì›</button>
        <button class="category-btn" onclick="filterCategory('ì‘ê¸‰ì‹¤')">ğŸš‘ ì‘ê¸‰ì‹¤</button>
    </div>
    <div id="hospitalList"></div>
    <div id="map"></div>

    <!-- ê¸¸ì°¾ê¸° ë²„íŠ¼ (ë¦¬ìŠ¤íŠ¸ í•˜ë‹¨) -->
    <div class="directions-container">
        <button class="directions-btn" onclick="openKakaoDirections()">ê¸¸ì°¾ê¸°</button>
    </div>

    <script>
        var map = new kakao.maps.Map(document.getElementById('map'), {
            center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ì‹œì²­ ì¢Œí‘œ (ë³€ê²½ ê°€ëŠ¥)
            level: 4
        });

        var listElement = document.getElementById('hospitalList');
        var selectedMarker = null; // í˜„ì¬ í´ë¦­ëœ ë§ˆì»¤ ì €ì¥
        var center = map.getCenter();
        var lat = center.getLat(); // ìœ„ë„
        var lng = center.getLng(); // ê²½ë„

        fetch("/map/nearbyHospitals")
        .then(response => response.json())
        .then(data => { 
            data.sort((a, b) => a.distance - b.distance); // ê±°ë¦¬ìˆœ ì •ë ¬

            data.forEach(function(place) {
                var position = new kakao.maps.LatLng(place.latitude, place.longitude);

                var normalImage = new kakao.maps.MarkerImage(
                    "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png",
                    new kakao.maps.Size(33, 36)
                );

                var overImage = new kakao.maps.MarkerImage(
                    "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png",
                    new kakao.maps.Size(40, 42)
                );

                var clickImage = new kakao.maps.MarkerImage(
                    "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",
                    new kakao.maps.Size(33, 36)
                );

                var marker = new kakao.maps.Marker({
                    position: position,
                    map: map,
                    image: normalImage
                });

                var infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:5px;">${place.hospitalName || place.pharmacyName || place.storeName || "ì¥ì†Œ"}</div>`
                });

                kakao.maps.event.addListener(marker, 'mouseover', function() {
                    if (selectedMarker !== marker) {
                        marker.setImage(overImage);
                    }
                    infowindow.open(map, marker);
                });

                kakao.maps.event.addListener(marker, 'mouseout', function() {
                    if (selectedMarker !== marker) {
                        marker.setImage(normalImage);
                    }
                    infowindow.close();
                });

                kakao.maps.event.addListener(marker, 'click', function() {
                    if (selectedMarker) {
                        selectedMarker.setImage(normalImage);
                    }
                    marker.setImage(clickImage);
                    selectedMarker = marker;
                    map.setCenter(position); // ğŸ¥ í´ë¦­ ì‹œ ì§€ë„ ì¤‘ì•™ ì´ë™

                    // ë¦¬ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ ë³‘ì› ê°•ì¡° í‘œì‹œ ë° ìŠ¤í¬ë¡¤ ì´ë™
                    document.querySelectorAll('.hospital-item').forEach(item => item.classList.remove('highlight'));
                    let targetItem = Array.from(document.querySelectorAll('.hospital-item')).find(item =>
                        item.innerText.includes(place.hospitalName || place.pharmacyName || place.storeName || "ì¥ì†Œ")
                    );
                    if (targetItem) {
                        targetItem.classList.add('highlight');
                        targetItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });

                var item = document.createElement('div');
                item.className = 'hospital-item';
                item.innerText = `${place.hospitalName || place.pharmacyName || place.storeName || "ì¥ì†Œ"} - ${place.distance.toFixed(0)}m`;
                item.onclick = function() {
                    window.location.href = `/map/hospitaldetail?name=${encodeURIComponent(place.hospitalName || place.pharmacyName || place.storeName || "ì¥ì†Œ")}&address=${encodeURIComponent(place.address)}&lat=${place.latitude}&lng=${place.longitude}&phone=${place.phoneNumber}`;
                };
                listElement.appendChild(item);
            });
        });

        function openKakaoDirections() {
            window.open("https://map.kakao.com", "_blank");
        }
    </script>
</body>
</html>
